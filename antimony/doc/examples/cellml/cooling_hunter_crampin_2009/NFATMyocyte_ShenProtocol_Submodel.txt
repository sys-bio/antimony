//Created by libAntimony v1.4
model calcium__calcium(t, Ca)

  // Assignment Rules:
  Ca := piecewise( 1000 * (timeInStim_modTrainPeriod - 5 ) * -(9.884615385 ) + 290.6923077 , (( timeInStim_modTrainPeriod >= 5) && (timeInStim_modTrainPeriod <= 5.02) && (t < stimEnd )), 1000 * timeInStim_modPulsePeriod * 51.89423077 + 290.6923077 , (( timeInStim_modTrainPeriod < 5) && (timeInStim_modPulsePeriod <= 0.016) && (t < stimEnd )), 1000 * (timeInStim_modPulsePeriod - 0.016 ) * -(9.884615385 ) + 1121 , (( timeInStim_modTrainPeriod < 5) && (timeInStim_modPulsePeriod > 0.016) && (t < stimEnd )), 93 );
  timeInStim_modTrainPeriod := t - floor(t / trainPeriod) * trainPeriod;
  timeInStim_modPulsePeriod := t - floor(t / 0.1 ) * 0.1;

  // Variable initializations:
  stimEnd = 3600;
  trainPeriod = 50;
end

model calcineurin__calcineurin(t, Ca, Ntot, act_Napp)

  // Assignment Rules:
  act_N := power(Ca, n) / (power(Ca, n) + power(K_mN, n) * (1 + K_dN / M));
  act_Napp := piecewise( act_N , t < tNinhib , act_N * power(exponentiale , -((t - tNinhib)) / tau_actN) , t >= tNinhib );

  // Variable initializations:
  M = 6000;
  Ntot = 1000;
  K_mN = 535;
  n = 2.92;
  K_dN = 1760;
  tau_actN = 0.070059;
  tNinhib = 3600;
end

model NFATCycling__NFAT_Cycling(t, NFATN_n, NFATp_n, Ccn, act_N, Ntot)

  // Assignment Rules:
  J1 := k_f1 * NFATp_c * Ntot * act_N - k_r1 * NFATN_c * (1 - act_N);
  J2 := k_f2 * NFATN_c;
  J3 := k_f3 * NFATN_n * (1 - act_N) - k_r3 * NFATp_n * Ntot * act_N;
  J4 := k_f4 * NFATp_n;

  // Rate Rules:
  NFATN_c' = J1 - J2;
  NFATN_n' = J2 * Ccn - J3;
  NFATp_c' = J4 / Ccn - J1;
  NFATp_n' = J3 - J4;

  // Variable initializations:
  NFATN_c = 0.0017047398;
  NFATN_n = 0.50910553;
  NFATp_c = 0.9825855442;
  NFATp_n = 0.27638027;
  k_f1 = 7.68934e-6;
  k_r1 = 0.019256;
  k_f2 = 0.00144192;
  k_f3 = 0.000361944;
  k_r3 = 4.70813e-5;
  k_f4 = 0.000444695;
end

model NFATMyocyte_ShenProtocol__NFAT_Cycling_interface(NFATN_n, NFATp_n)

  // Assignment Rules:
  nuclearNFAT := NFATN_n + NFATp_n;
end

model NFATMyocyte_ShenProtocol__geometry(Ccn)

  // Sub-modules, and any changes to those submodules:
  calcium: calcium__calcium(t, Ca);
  calcineurin: calcineurin__calcineurin(t0, Ca, Ntot, act_N);
  NFAT_Cycling: NFATCycling__NFAT_Cycling(t1, NFATN_n, NFATp_n, Ccn, act_N, Ntot);
  NFAT_Cycling_interface: NFATMyocyte_ShenProtocol__NFAT_Cycling_interface(NFATN_n, NFATp_n);

  // Variable initializations:
  Ccn = 50;
end

model NFATMyocyte_ShenProtocol__environment(t)

  // Sub-modules, and any changes to those submodules:
  geometry: NFATMyocyte_ShenProtocol__geometry(Ccn);
  geometry.calcium.t is t;
  geometry.calcineurin.t is t;
  geometry.NFAT_Cycling.t is t;
end

model NFATMyocyte_ShenProtocol____main()

  // Sub-modules, and any changes to those submodules:
  environment: NFATMyocyte_ShenProtocol__environment(t);
end
